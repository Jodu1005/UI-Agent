# input-field-action Specification

## Purpose
TBD - created by archiving change support-input-field-action. Update Purpose after archive.
## 需求
### 需求：INPUT 意图类型

系统**必须**支持 `INPUT` 意图类型，用于标识需要在输入框中输入文本的命令。意图关键词映射**必须**包含"输入"、"输入文本"、"在输入框中输入"等关键词。

#### 场景：通过关键词识别输入意图
- **Given** 用户发出自然语言命令
- **When** 命令包含"输入"、"输入文本"、"在输入框中输入"等关键词
- **Then** 系统应识别为 INPUT 意图

---

### 需求：输入框命令参数提取

命令解析器**必须**能从自然语言命令中提取输入框操作的必要参数，包括 `context_text`（上下文描述）、`position_hint`（位置提示）、`input_text`（要输入的文本）和 `submit_action`（提交动作）。

#### 场景：提取上下文描述和位置提示
- **Given** 命令为"在本地下方的输入框中输入 test 并回车"
- **When** 解析命令
- **Then** 应提取以下参数：
  - `context_text`: "本地"（用于定位参考元素）
  - `position_hint`: "下方"（位置关系）
  - `input_text`: "test"（要输入的文本）
  - `submit_action`: "enter"（提交动作）

#### 场景：简化命令格式参数提取
- **Given** 命令为"在搜索框输入 hello"
- **When** 解析命令
- **Then** 应提取：
  - `context_text`: "搜索"（直接描述目标）
  - `input_text`: "hello"
  - `submit_action`: null（未指定）

#### 场景：带引号的文本输入参数提取
- **Given** 命令为"在输入框输入 'hello world'"
- **When** 解析命令
- **Then** `input_text` 必须为 "hello world"（保留空格）

---

### 需求：上下文描述的输入框定位

视觉定位器**必须**支持通过上下文描述和位置关系定位输入框。系统**必须**能够根据参考元素（如"本地"关键字）和位置关系（如"下方"、"右侧"）定位目标输入框。

#### 场景：通过参考元素下方定位
- **Given** 视觉提示词包含"在包含文本'本地'的元素下方"
- **When** 执行视觉定位
- **Then** 应返回参考元素下方的输入框元素

#### 场景：通过参考元素右侧定位
- **Given** 视觉提示词包含"在包含文本'搜索'的元素右侧"
- **When** 执行视觉定位
- **Then** 应返回参考元素右侧的输入框元素

#### 场景：直接描述定位
- **Given** 视觉提示词包含"搜索输入框"
- **When** 执行视觉定位
- **Then** 应返回匹配描述的输入框元素

---

### 需求：input_text 操作配置

系统**必须**提供 `input_text` 操作配置。该配置**必须**定义包含点击输入框、输入文本、按回车键的操作序列。

#### 场景：完整的输入框操作序列（带回车）
- **Given** 用户命令"在本地下方的输入框中输入 test 并回车"
- **When** 执行操作
- **Then** 应按以下序列执行：
  1. 定位输入框元素
  2. 点击输入框（激活焦点）
  3. 输入文本 "test"
  4. 按下 Enter 键

#### 场景：不带回车的输入操作
- **Given** 用户命令"在输入框输入 test"（未指定回车）
- **When** 执行操作
- **Then** 应只执行：点击 → 输入，不按回车

---

### 需求：输入框操作验证

系统**必须**在执行后验证输入操作是否成功。如果操作失败，系统**必须**支持重试机制，最多重试 3 次。

#### 场景：输入后焦点保持验证
- **Given** 已执行输入操作
- **When** 检查执行结果
- **Then** 如果输入框仍保持焦点状态，认为操作成功

#### 场景：输入失败重试机制
- **Given** 第一次输入操作失败
- **When** 检测到失败
- **Then** 应重试最多 3 次

---

