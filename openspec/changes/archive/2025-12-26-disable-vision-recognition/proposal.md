# 提案：支持通过配置关闭基于大模型的视觉识别

## 变更ID

`disable-vision-recognition`

## 概述

添加配置选项，允许用户禁用基于大模型的视觉识别功能，改为仅使用 OCR 或其他备用定位方式。

## 动机

当前项目在 UI 元素定位时默认使用智谱 AI 的视觉大模型（GLM-4V），这会带来以下问题：

1. **成本问题**：每次视觉识别都会调用 API 产生费用
2. **网络依赖**：需要稳定的网络连接才能使用
3. **隐私考虑**：截图会被上传到第三方服务
4. **延迟问题**：API 调用有网络延迟

虽然当前代码已经支持 OCR 作为回退机制，但没有提供完全禁用视觉识别的选项。此提案将：

- 允许用户通过配置完全禁用大模型视觉识别
- 在禁用后自动使用 OCR 或其他备用定位方法
- 提供清晰的配置选项和文档说明

## 影响范围

### 修改范围

1. **配置系统**
   - 在 `config/main.yaml` 的 `automation` 或新增 `vision` 部分添加 `enabled` 配置
   - 更新 `src/config/schema.py` 中的配置数据类

2. **定位器**
   - 修改 `src/locator/visual_locator.py` 的 `VisualLocator` 类
   - 在 `locate` 方法中检查配置，当视觉识别禁用时直接跳过

3. **控制器**
   - 修改 `src/controller/ide_controller.py`，传递视觉识别配置给定位器

### 非影响范围

- OCR 定位逻辑保持不变
- 其他自动化执行功能不受影响
- 安全配置保持独立

## 替代方案

### 方案 A：环境变量控制
通过环境变量 `DISABLE_VISION` 来控制。

**优点**：简单直接，无需修改配置文件
**缺点**：不够灵活，无法在同一环境中有不同配置

### 方案 B：命令行参数
在启动时通过命令行参数控制。

**优点**：临时禁用很方便
**缺点**：需要修改启动逻辑

### 方案 C：配置文件控制（推荐）
在配置文件中添加专门的 `vision.enabled` 配置项。

**优点**：
- 与现有配置系统一致
- 支持热更新
- 便于文档化和维护

**缺点**：需要修改配置文件

## 风险评估

- **兼容性风险**：低 - 新增配置，默认值为 `true` 保持现有行为
- **功能风险**：低 - 禁用后使用 OCR 回退，现有 OCR 功能已验证
- **测试风险**：中 - 需要确保禁用后所有操作仍能正常工作

## 依赖项

无外部依赖，依赖于现有的 OCR 功能。

## 向后兼容性

完全向后兼容。默认配置下行为不变，只有显式设置 `vision.enabled: false` 才会改变行为。

## 参考资料

- 现有视觉定位实现：`src/locator/visual_locator.py`
- 配置系统：`src/config/schema.py`、`src/config/config_manager.py`
- OCR 回退机制：`VisualLocator._locate_hybrid()` 方法
