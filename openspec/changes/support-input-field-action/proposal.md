# 支持输入框输入操作的变更提案

## 变更ID
`support-input-field-action`

## 概述

本提案旨在为 UI-Agent 系统添加支持在 IDE 的输入框中输入文本并回车的功能。当前系统支持通过视觉定位找到 UI 元素并进行点击、双击等操作，但对于需要在特定输入框中输入文本的场景支持不足。

## 背景

### 当前状态
- 系统已支持视觉定位 UI 元素（通过 GLM-4V-Flash）
- 已支持基本的鼠标操作（点击、双击、右键点击）
- 已支持键盘快捷键操作
- 已支持简单的 `type` 操作（直接输入文本）

### 问题
用户提出的需求示例："在'本地'关键字下方的输入框中输入 test 并回车"，这涉及：
1. 通过视觉定位找到特定输入框（通过上下文描述定位）
2. 点击输入框以激活焦点
3. 输入指定文本
4. 按下回车键

当前 `type` 操作只是直接输入，不支持先点击激活输入框的流程。

## 目标

1. 支持通过上下文描述（如"本地关键字下方"）精确定位输入框
2. 支持点击输入框激活焦点的操作
3. 支持在输入框中输入文本
4. 支持输入后按回车键确认

## 范围

### 包含
- 添加新的意图类型 `INPUT` 用于输入框操作
- 在 `CommandParser` 中添加解析输入框相关命令的逻辑
- 在 `pycharm.yaml` 中添加 `input_text` 操作配置
- 支持上下文描述定位（如"本地下方"、"右侧面板"等）

### 不包含
- 复杂的表单填写（多字段）
- 下拉选择框操作
- 密码输入框的特殊处理

## 影响范围

### 影响的模块
- `src/parser/intents.py` - 添加 INPUT 意图类型
- `src/parser/command_parser.py` - 添加输入框命令的参数提取逻辑
- `config/operations/pycharm.yaml` - 添加 input_text 操作配置

### 不受影响的模块
- `src/locator/visual_locator.py` - 现有定位能力已足够
- `src/automation/executor.py` - 现有操作已足够（click + type + shortcut）

## 向后兼容性

此变更完全向后兼容：
- 新增的意图类型不影响现有意图
- 新增的操作配置不影响现有操作
- 现有命令解析逻辑保持不变

## 风险评估

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 视觉定位准确性低 | 中 | 使用混合定位（GLM + OCR）提高准确度 |
| 输入框焦点激活失败 | 低 | 增加重试机制和延迟等待 |
| 上下文描述理解偏差 | 中 | 优化 visual_prompt 提示词 |

## 依赖关系

无外部依赖。依赖现有的视觉定位和自动化执行能力。

## 替代方案

### 方案A：扩展现有 type 操作
在现有 type 操作前自动点击。缺点是不够灵活，无法处理需要先点击其他区域的情况。

### 方案B：使用快捷键跳转
使用快捷键直接跳转到输入框。缺点是不同 IDE 快捷键不同，通用性差。

### 方案C（本提案）：组合操作
通过配置定义操作序列：点击 → 输入 → 回车。优点是灵活可配置。

## 验收标准

1. 支持命令如"在本地下方的输入框中输入 test 并回车"
2. 能够通过上下文描述定位输入框
3. 成功完成点击、输入、回车操作序列
4. 相关单元测试通过
